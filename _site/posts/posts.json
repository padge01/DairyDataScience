[
  {
    "path": "posts/2022-08-11-overlaid-plots-in-ggplot2/",
    "title": "Overlaid plots in ggplot2",
    "description": "How to reshape your data and plot the density of repeated measures for easy data visualization",
    "author": [
      {
        "name": "Padraig Lucey",
        "url": "https://www.linkedin.com/in/p%C3%A1draig-lucey-687506124/"
      }
    ],
    "date": "2022-08-09",
    "categories": [],
    "contents": "\r\nWhen working with variables that have repeated measurements on a\r\nregular interval it can be useful to visualize how the values change by\r\nmeasurement. Density plots are a great way of describing a variable and\r\nlet you quickly visualize how the data is distributed.\r\nIn biology we usually assume the central limit theorem, that the sum\r\nof independent random variables tends towards a normal distribution. But\r\nunderstanding the distribution of a variable of interest, if it assumes\r\na normal distribution, if there is skew, or if it could be better\r\ndescribed by an alternate distribution shape can be important\r\ninformation.\r\nIn this article I will demonstrate using a sample database how you\r\ncan appropriately set up your data, then visualize the density plot on\r\neach level of a repeated variable and how you can easily overlay them\r\nusing ggplot2 in R Studio. This provides an easy visual assessment of\r\nthe shape and distribution of your data over time.\r\nSetting up the data\r\nThe data I am using includes individual cow records with weekly\r\nmeasurements of milk yield and feed consumption (DMI as dry matter\r\nintake) in kilograms. Immediately after a cow gives birth her milk\r\nproduction and feed requirement quickly increase, but usually the energy\r\ndemand for milk production exceeds the cows ability to consume enough\r\nfeed in the first several weeks. Here we will examine and plot the\r\ndistribution of milk and DMI for this cow group over the first 4 weeks\r\nof the lactation.\r\nLoading packages and data\r\nFor data manipulation I will use the tidyverse package\r\n\r\n\r\nlibrary(tidyverse)\r\n\r\n\r\n\r\nNext I load, then create a subset of my full dataset with just the\r\nmeasurements of the weeks of interest.\r\n\r\n\r\nload(\"lact2all.rda\")\r\ngroup1 <- select(lact2all, CowID, dmi1, dmi2, dmi3, dmi4, milk1, milk2, milk3, milk4) \r\ngroup1 %>% as_tibble() %>% head()\r\n\r\n\r\n# A tibble: 6 x 9\r\n  CowID  dmi1  dmi2  dmi3  dmi4 milk1 milk2 milk3 milk4\r\n  <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl>\r\n1  1546 14.5   14.9 19.1   17.8  22.9  26.6  31.7  31.5\r\n2  1594 15.7   16.0 17.6   19.9  34.2  35    38.3  42.0\r\n3  1595 14.0   13.7  9.73  12.0  36.2  34.5  20.8  26.6\r\n4  1601 17.5   17.5 19.2   17.6  33.9  38.8  43    42.4\r\n5  1639  9.41  11.7 14.8   15.8  24.1  24.5  28.6  33.6\r\n6  1640 18.3   18.1 17.6   19.5  21.7  31.9  34.5  38.1\r\n\r\nConvert\r\nthe data to longform with a single column for variable name and\r\nvalues\r\nUsing the melt function from the reshape package we can easily make\r\nthis data set long by pivoting around the unique CowID as our id\r\nvariable.\r\n\r\n\r\nlibrary(reshape)\r\nplotdata <- reshape::melt(group1, id=\"CowID\"); \r\nplotdata %>% group_by(variable) %>% summarise(Cows = n_distinct(CowID))\r\n\r\n\r\n# A tibble: 8 x 2\r\n  variable  Cows\r\n  <fct>    <int>\r\n1 dmi1       316\r\n2 dmi2       316\r\n3 dmi3       316\r\n4 dmi4       316\r\n5 milk1      316\r\n6 milk2      316\r\n7 milk3      316\r\n8 milk4      316\r\n\r\nBuilding a\r\ndensity plot in ggplot2 and overlaying weeks\r\nLoading the ggplot2 package we can build a density plot object using\r\nthe variable column from our melted data set as the fill. Because we\r\nhave multiple levels of the variable factor (milk1:milk4, dmi1:dmi4)\r\nthis will create a separate density plot for each. We need to specify it\r\nas a density plot by adding geom_density to the plot object using\r\n+ geom_density(alpha=x). The alpha number sets the opacity\r\nof the color fill of each density plot. Because we expect overlap it is\r\nsmart to set this number low.\r\nRemember, when adding elements to a ggplot2 object the +\r\nmust be entered at the end of your line, not at the beginning of a new\r\nline.\r\n\r\n\r\nlibrary(ggplot2)\r\nPlot <- ggplot(plotdata, aes(x=value, fill=variable)) +\r\n  geom_density(alpha=0.6)\r\nPlot\r\n\r\n\r\n\r\n\r\nNext we can add axes labels to our plot.\r\n\r\n\r\nPlot + labs(title=\"Density of DMI and milk by week\", \r\n                                 x=\"Kilograms DM\", y=\"Proportion of cows\") \r\n\r\n\r\n\r\n\r\nWe can alter the limits of each axis to change where our plot begins\r\nand ends. I will start the x axis at 5 kg since we know cowâ€™s will not\r\neat or milk a quantity of 0 kg.\r\n\r\n\r\nPlot + labs(title=\"Density of DMI and milk by week\", \r\n                                 x=\"Kilograms DM\", y=\"Proportion of cows\") + \r\n          xlim(5, 65) + ylim(0, 0.13)\r\n\r\n\r\n\r\n\r\nFinally we will edit the legend to give appropriate names to the plot\r\ncolor fills.\r\n\r\n\r\nPlot + labs(title=\"Density of DMI and milk by week\", \r\n                                 x=\"Kilograms DM\", y=\"Proportion of cows\") + \r\n          xlim(5, 65) + ylim(0, 0.13) +\r\n                scale_fill_discrete(name= \"Week\", labels=c(\"DMI 1\", \"DMI 2\", \"DMI 3\", \"DMI 4\",\r\n                                                                        \"Milk 1\", \"Milk 2\", \"Milk 3\", \"Milk 4\"))\r\n\r\n\r\n\r\n\r\nConclusion\r\nThe result is a graph of the density and distribution of each of our\r\nvariables at the repeated time points. First using the reshape package\r\nwe easily converted our data to long form. Then with ggplot2 we created\r\na density plot object that overlaid the values of each variable by\r\nmeasurement time point. This produced an easy and useful visualization\r\nof how the distribution of these variables changed across the time\r\nperiod of interest for exploring and understanding our data.\r\n\r\n\r\n\r\n",
    "preview": "posts/2022-08-11-overlaid-plots-in-ggplot2/overlaid-plots-in-ggplot2_files/figure-html5/unnamed-chunk-4-1.png",
    "last_modified": "2022-08-11T13:51:05-07:00",
    "input_file": {},
    "preview_width": 1248,
    "preview_height": 768
  },
  {
    "path": "posts/welcome/",
    "title": "Welcome to Dairy Data Science",
    "description": "Welcome to the site.",
    "author": [
      {
        "name": "Padraig Lucey",
        "url": "https://www.linkedin.com/in/p%C3%A1draig-lucey-687506124/"
      }
    ],
    "date": "2021-10-29",
    "categories": [],
    "contents": "\r\nApplying data science to Dairy Production\r\nThis is a website exploring data science in the field of dairy cow production medicine. It will feature short explanations of data visualization and analysis techniques using commercial dairy data.\r\n\r\n\r\n\r\n",
    "preview": {},
    "last_modified": "2021-11-01T12:43:27-07:00",
    "input_file": {}
  }
]
